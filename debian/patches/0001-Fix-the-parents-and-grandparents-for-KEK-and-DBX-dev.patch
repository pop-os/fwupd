From d1ca6e46cd94ea9108709386f066475f29b4dfa4 Mon Sep 17 00:00:00 2001
From: Mario Limonciello <mario.limonciello@amd.com>
Date: Fri, 11 Apr 2025 12:42:27 -0500
Subject: [PATCH] Fix the parents and grandparents for KEK and DBX devices

---
 plugins/uefi-capsule/README.md        | 3 +--
 plugins/uefi-db/fu-uefi-db-device.c   | 2 +-
 plugins/uefi-kek/fu-uefi-kek-device.c | 2 +-
 plugins/uefi-pk/fu-uefi-pk-device.c   | 2 +-
 4 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/plugins/uefi-capsule/README.md b/plugins/uefi-capsule/README.md
index a5db53f2b..425f88da2 100644
--- a/plugins/uefi-capsule/README.md
+++ b/plugins/uefi-capsule/README.md
@@ -109,8 +109,7 @@ required.
 
 ## GUID Generation
 
-These devices use the UEFI GUID as provided in the ESRT. Additionally, for the
-system device the `main-system-firmware` internal flag is also added.
+These devices use the UEFI GUID as provided in the ESRT.
 
 For compatibility with Windows 10, the plugin also adds GUIDs of the form
 `UEFI\RES_{$(esrt)}`.
diff --git a/plugins/uefi-db/fu-uefi-db-device.c b/plugins/uefi-db/fu-uefi-db-device.c
index e5b009eac..2868e5cd1 100644
--- a/plugins/uefi-db/fu-uefi-db-device.c
+++ b/plugins/uefi-db/fu-uefi-db-device.c
@@ -146,7 +146,7 @@ fu_uefi_db_device_init(FuUefiDbDevice *self)
 {
 	fu_device_set_physical_id(FU_DEVICE(self), "db");
 	fu_device_set_name(FU_DEVICE(self), "UEFI Signature Database");
-	fu_device_add_parent_guid(FU_DEVICE(self), "main-system-firmware");
+	fu_device_add_private_flag(FU_DEVICE(self), FU_DEVICE_PRIVATE_FLAG_HOST_FIRMWARE_CHILD);
 	fu_device_set_firmware_gtype(FU_DEVICE(self), FU_TYPE_EFI_SIGNATURE_LIST);
 	fu_device_add_icon(FU_DEVICE(self), "application-certificate");
 }
diff --git a/plugins/uefi-kek/fu-uefi-kek-device.c b/plugins/uefi-kek/fu-uefi-kek-device.c
index b94fc7347..c3b892b8d 100644
--- a/plugins/uefi-kek/fu-uefi-kek-device.c
+++ b/plugins/uefi-kek/fu-uefi-kek-device.c
@@ -103,7 +103,7 @@ fu_uefi_kek_device_init(FuUefiKekDevice *self)
 {
 	fu_device_set_physical_id(FU_DEVICE(self), "KEK");
 	fu_device_set_name(FU_DEVICE(self), "UEFI Key Exchange Key");
-	fu_device_add_parent_guid(FU_DEVICE(self), "main-system-firmware");
+	fu_device_add_private_flag(FU_DEVICE(self), FU_DEVICE_PRIVATE_FLAG_HOST_FIRMWARE_CHILD);
 	fu_device_set_firmware_gtype(FU_DEVICE(self), FU_TYPE_EFI_SIGNATURE_LIST);
 	fu_device_add_icon(FU_DEVICE(self), "application-certificate");
 }
diff --git a/plugins/uefi-pk/fu-uefi-pk-device.c b/plugins/uefi-pk/fu-uefi-pk-device.c
index c0b829927..9a853b58f 100644
--- a/plugins/uefi-pk/fu-uefi-pk-device.c
+++ b/plugins/uefi-pk/fu-uefi-pk-device.c
@@ -142,7 +142,7 @@ fu_uefi_pk_device_init(FuUefiPkDevice *self)
 {
 	fu_device_set_physical_id(FU_DEVICE(self), "pk");
 	fu_device_set_summary(FU_DEVICE(self), "UEFI Platform Key");
-	fu_device_add_parent_guid(FU_DEVICE(self), "main-system-firmware");
+	fu_device_add_private_flag(FU_DEVICE(self), FU_DEVICE_PRIVATE_FLAG_HOST_FIRMWARE_CHILD);
 	fu_device_add_icon(FU_DEVICE(self), "application-certificate");
 	fu_device_set_firmware_gtype(FU_DEVICE(self), FU_TYPE_EFI_SIGNATURE_LIST);
 	fu_device_set_version_format(FU_DEVICE(self), FWUPD_VERSION_FORMAT_NUMBER);
-- 
2.43.0

