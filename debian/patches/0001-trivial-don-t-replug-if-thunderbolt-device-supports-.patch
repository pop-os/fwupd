From f7b6fa2e829b5ab95ee1e37fd06ecce3bdf39928 Mon Sep 17 00:00:00 2001
From: Crag Wang <crag.wang@dell.com>
Date: Wed, 9 Feb 2022 22:54:06 +0800
Subject: [PATCH] trivial: don't replug if thunderbolt device supports auth on
 disconnect

Fixes: #4262
---
 plugins/thunderbolt/fu-thunderbolt-controller.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/plugins/thunderbolt/fu-thunderbolt-controller.c b/plugins/thunderbolt/fu-thunderbolt-controller.c
index cb4edab4..fd5573d7 100644
--- a/plugins/thunderbolt/fu-thunderbolt-controller.c
+++ b/plugins/thunderbolt/fu-thunderbolt-controller.c
@@ -310,7 +310,8 @@ fu_thunderbolt_controller_write_firmware(FuDevice *device,
 	if (!FU_DEVICE_CLASS(fu_thunderbolt_controller_parent_class)
 		 ->write_firmware(device, firmware, progress, flags, error))
 		return FALSE;
-	fu_device_add_flag(device, FWUPD_DEVICE_FLAG_WAIT_FOR_REPLUG);
+	if (!fu_device_has_flag(device, FWUPD_DEVICE_FLAG_USABLE_DURING_UPDATE))
+		fu_device_add_flag(device, FWUPD_DEVICE_FLAG_WAIT_FOR_REPLUG);
 	return TRUE;
 }
 
-- 
2.34.1

